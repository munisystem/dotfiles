[ghq]
  root=~/workspace/repos

[user]
  name = Yuichi Saito

  email = {{ get . "email" | default "munisystem@gmail.com" }}
  signingkey = {{ get . "signingKey" | default "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGAaFkpU7qSqJan2xTP8eez4Wq5DHC4zYRaf4Q7Oiv+o" }}

[commit]
  gpgSign = true

[gpg]
  format = ssh

[gpg "ssh"]
  program = "/Applications/1Password.app/Contents/MacOS/op-ssh-sign"

[commit]
  gpgsign = true

[alias]
  cleanup = "!f() { \
    git fetch --prune; \
    default_branch=$(git symbolic-ref refs/remotes/origin/HEAD 2>/dev/null | sed 's@^refs/remotes/origin/@@' || echo 'main'); \
    for branch in $(git branch --merged \"$default_branch\" | grep -v '\\*\\|main\\|master' | tr -d ' +'); do \
      worktree=$(git worktree list --porcelain | awk -v b=\"$branch\" ' \
        /^worktree /{p=substr($0,10)} \
        /^branch /{gsub(/refs\\/heads\\//,\"\",$2); if($2==b){print p;exit}}'); \
      [ -n \"$worktree\" ] && git worktree remove \"$worktree\"; \
      git branch -d \"$branch\"; \
    done; \
  }; f"

  po = "push origin head"

  pu = "!f() { \
    branch=$(git branch --contains | cut -d \" \" -f 2); \
    git pull origin $branch; \
  }; f"
